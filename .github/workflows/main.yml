name: iOS Simulator Test

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: List iOS Simulators
      run: xcrun simctl list devices available
    
    - name: Boot iPhone 15
      run: |
        DEVICE_ID=$(xcrun simctl list devices | grep "iPhone 15" | head -1 | grep -oE '\([A-F0-9-]+\)' | tr -d '()')
        echo "Booting device: $DEVICE_ID"
        xcrun simctl boot $DEVICE_ID || echo "Already booted"
    
    - name: Wait for boot
      run: sleep 20
    
    - name: Take Screenshot
      run: |
        xcrun simctl io booted screenshot screenshot.png
        ls -lh screenshot.png
    
    - name: Upload Screenshot
      uses: actions/upload-artifact@v4
      with:
        name: simulator-screenshot
        path: screenshot.png
